(function(){var n=this,t=n._,r={},e=Array.prototype,i=Object.prototype,u=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=i.toString,f=i.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,y=e.every,g=e.some,m=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,w=u.bind,j=function(n){return n instanceof j?n:this instanceof j?void(this._wrapped=n):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.5.1";var A=j.each=j.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var i=0,u=n.length;i<u;i++)if(t.call(e,n[i],i,n)===r)return}else for(var a in n)if(j.has(n,a)&&t.call(e,n[a],a,n)===r)return};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,i,u){e.push(t.call(r,n,i,u))}),e)};var E="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var i=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),i?n.reduce(t,r):n.reduce(t);if(A(n,function(n,u,a){i?r=t.call(e,r,n,u,a):(r=n,i=!0)}),!i)throw new TypeError(E);return r},j.reduceRight=j.foldr=function(n,t,r,e){var i=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),i?n.reduceRight(t,r):n.reduceRight(t);var u=n.length;if(u!==+u){var a=j.keys(n);u=a.length}if(A(n,function(o,c,l){c=a?a[--u]:--u,i?r=t.call(e,r,n[c],c,l):(r=n[c],i=!0)}),!i)throw new TypeError(E);return r},j.find=j.detect=function(n,t,r){var e;return O(n,function(n,i,u){if(t.call(r,n,i,u))return e=n,!0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,i,u){t.call(r,n,i,u)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,i){return!t.call(r,n,e,i)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var i=!0;return null==n?i:y&&n.every===y?n.every(t,e):(A(n,function(n,u,a){if(!(i=i&&t.call(e,n,u,a)))return r}),!!i)};var O=j.some=j.any=function(n,t,e){t||(t=j.identity);var i=!1;return null==n?i:g&&n.some===g?n.some(t,e):(A(n,function(n,u,a){if(i||(i=t.call(e,n,u,a)))return r}),!!i)};j.contains=j.include=function(n,t){return null!=n&&(m&&n.indexOf===m?-1!=n.indexOf(t):O(n,function(n){return n===t}))},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,function(n){return n[t]})},j.where=function(n,t,r){return j.isEmpty(t)?r?void 0:[]:j[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},j.findWhere=function(n,t){return j.where(n,t,!0)},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);if(!t&&j.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,i,u){var a=t?t.call(r,n,i,u):n;a>e.computed&&(e={value:n,computed:a})}),e.value},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);if(!t&&j.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,i,u){var a=t?t.call(r,n,i,u):n;a<e.computed&&(e={value:n,computed:a})}),e.value},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e};var F=function(n){return j.isFunction(n)?n:function(t){return t[n]}};j.sortBy=function(n,t,r){var e=F(t);return j.pluck(j.map(n,function(n,t,i){return{value:n,index:t,criteria:e.call(r,n,t,i)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r)return 1;if(r<e||void 0===e)return-1}return n.index<t.index?-1:1}),"value")};var k=function(n,t,r,e){var i={},u=F(null==t?j.identity:t);return A(n,function(t,a){var o=u.call(r,t,a,n);e(i,o,t)}),i};j.groupBy=function(n,t,r){return k(n,t,r,function(n,t,r){(j.has(n,t)?n[t]:n[t]=[]).push(r)})},j.countBy=function(n,t,r){return k(n,t,r,function(n,t){j.has(n,t)||(n[t]=0),n[t]++})},j.sortedIndex=function(n,t,r,e){for(var i=(r=null==r?j.identity:F(r)).call(e,t),u=0,a=n.length;u<a;){var o=u+a>>>1;r.call(e,n[o])<i?u=o+1:a=o}return u},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){if(null!=n)return null==t||r?n[0]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){if(null!=n)return null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var R=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return R(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var i=r?j.map(n,r,e):n,u=[],a=[];return A(i,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),u.push(n[e]))}),u},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.indexOf(t,n)>=0})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;r<n;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,i=n.length;e<i;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,i=n.length;if(r){if("number"!=typeof r)return n[e=j.sortedIndex(n,t)]===t?e:-1;e=r<0?Math.max(0,i+r):r}if(m&&n.indexOf===m)return n.indexOf(t,r);for(;e<i;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var i=e?r:n.length;i--;)if(n[i]===t)return i;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),i=0,u=new Array(e);i<e;)u[i++]=n,n+=r;return u};var M=function(){};j.bind=function(n,t){var r,e;if(w&&n.bind===w)return w.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));M.prototype=n.prototype;var i=new M;M.prototype=null;var u=n.apply(i,r.concat(o.call(arguments)));return Object(u)===u?u:i}},j.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,i,u,a=null,o=0;r||(r={});var c=function(){o=!1===r.leading?0:new Date,a=null,u=n.apply(e,i)};return function(){var l=new Date;o||!1!==r.leading||(o=l);var f=t-(l-o);return e=this,i=arguments,f<=0?(clearTimeout(a),a=null,o=l,u=n.apply(e,i)):a||!1===r.trailing||(a=setTimeout(c,f)),u}},j.debounce=function(n,t,r){var e,i=null;return function(){var u=this,a=arguments,o=r&&!i;return clearTimeout(i),i=setTimeout(function(){i=null,r||(e=n.apply(u,a))},t),o&&(e=n.apply(u,a)),e}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}},j.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){var t=[];for(var r in n)j.has(n,r)&&t.push(n[r]);return t},j.pairs=function(n){var t=[];for(var r in n)j.has(n,r)&&t.push([r,n[r]]);return t},j.invert=function(n){var t={};for(var r in n)j.has(n,r)&&(t[n[r]]=r);return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var i in n)j.contains(r,i)||(t[i]=n[i]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)void 0===n[r]&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var i=l.call(n);if(i!=l.call(t))return!1;switch(i){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var u=r.length;u--;)if(r[u]==n)return e[u]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==i){if(f=(c=n.length)==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return void 0===n},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),i=0;i<n;i++)e[i]=t.call(r,i);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};I.unescape=j.invert(I.escape);var T={escape:new RegExp("["+j.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(I.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(T[n],function(t){return I[n][t]})}}),j.result=function(n,t){if(null!=n){var r=n[t];return j.isFunction(r)?r.call(n):r}},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var i=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),u=0,a="__p+='";n.replace(i,function(t,r,e,i,o){return a+=n.slice(u,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),u=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(n){throw n.source=a,n}if(t)return e(t,j);var o=function(n){return e.call(this,n,j)};return o.source="function("+(r.variable||"obj")+"){\n"+a+"}",o},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);

(function(t){var e=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(i,r,n){e.Backbone=t(e,n,i,r)})}else if(typeof exports!=="undefined"){var i=require("underscore"),r;try{r=require("jquery")}catch(n){}t(e,exports,i,r)}else{e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}})(function(t,e,i,r){var n=t.Backbone;var s=Array.prototype.slice;e.VERSION="1.2.2";e.$=r;e.noConflict=function(){t.Backbone=n;return this};e.emulateHTTP=false;e.emulateJSON=false;var a=function(t,e,r){switch(t){case 1:return function(){return i[e](this[r])};case 2:return function(t){return i[e](this[r],t)};case 3:return function(t,n){return i[e](this[r],h(t,this),n)};case 4:return function(t,n,s){return i[e](this[r],h(t,this),n,s)};default:return function(){var t=s.call(arguments);t.unshift(this[r]);return i[e].apply(i,t)}}};var o=function(t,e,r){i.each(e,function(e,n){if(i[n])t.prototype[n]=a(e,n,r)})};var h=function(t,e){if(i.isFunction(t))return t;if(i.isObject(t)&&!e._isModel(t))return u(t);if(i.isString(t))return function(e){return e.get(t)};return t};var u=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}};var l=e.Events={};var c=/\s+/;var f=function(t,e,r,n,s){var a=0,o;if(r&&typeof r==="object"){if(n!==void 0&&"context"in s&&s.context===void 0)s.context=n;for(o=i.keys(r);a<o.length;a++){e=f(t,e,o[a],r[o[a]],s)}}else if(r&&c.test(r)){for(o=r.split(c);a<o.length;a++){e=t(e,o[a],n,s)}}else{e=t(e,r,n,s)}return e};l.on=function(t,e,i){return d(this,t,e,i)};var d=function(t,e,i,r,n){t._events=f(v,t._events||{},e,i,{context:r,ctx:t,listening:n});if(n){var s=t._listeners||(t._listeners={});s[n.id]=n}return t};l.listenTo=function(t,e,r){if(!t)return this;var n=t._listenId||(t._listenId=i.uniqueId("l"));var s=this._listeningTo||(this._listeningTo={});var a=s[n];if(!a){var o=this._listenId||(this._listenId=i.uniqueId("l"));a=s[n]={obj:t,objId:n,id:o,listeningTo:s,count:0}}d(t,e,r,this,a);return this};var v=function(t,e,i,r){if(i){var n=t[e]||(t[e]=[]);var s=r.context,a=r.ctx,o=r.listening;if(o)o.count++;n.push({callback:i,context:s,ctx:s||a,listening:o})}return t};l.off=function(t,e,i){if(!this._events)return this;this._events=f(g,this._events,t,e,{context:i,listeners:this._listeners});return this};l.stopListening=function(t,e,r){var n=this._listeningTo;if(!n)return this;var s=t?[t._listenId]:i.keys(n);for(var a=0;a<s.length;a++){var o=n[s[a]];if(!o)break;o.obj.off(e,r,this)}if(i.isEmpty(n))this._listeningTo=void 0;return this};var g=function(t,e,r,n){if(!t)return;var s=0,a;var o=n.context,h=n.listeners;if(!e&&!r&&!o){var u=i.keys(h);for(;s<u.length;s++){a=h[u[s]];delete h[a.id];delete a.listeningTo[a.objId]}return}var l=e?[e]:i.keys(t);for(;s<l.length;s++){e=l[s];var c=t[e];if(!c)break;var f=[];for(var d=0;d<c.length;d++){var v=c[d];if(r&&r!==v.callback&&r!==v.callback._callback||o&&o!==v.context){f.push(v)}else{a=v.listening;if(a&&--a.count===0){delete h[a.id];delete a.listeningTo[a.objId]}}}if(f.length){t[e]=f}else{delete t[e]}}if(i.size(t))return t};l.once=function(t,e,r){var n=f(p,{},t,e,i.bind(this.off,this));return this.on(n,void 0,r)};l.listenToOnce=function(t,e,r){var n=f(p,{},e,r,i.bind(this.stopListening,this,t));return this.listenTo(t,n)};var p=function(t,e,r,n){if(r){var s=t[e]=i.once(function(){n(e,s);r.apply(this,arguments)});s._callback=r}return t};l.trigger=function(t){if(!this._events)return this;var e=Math.max(0,arguments.length-1);var i=Array(e);for(var r=0;r<e;r++)i[r]=arguments[r+1];f(m,this._events,t,void 0,i);return this};var m=function(t,e,i,r){if(t){var n=t[e];var s=t.all;if(n&&s)s=s.slice();if(n)_(n,r);if(s)_(s,[e].concat(r))}return t};var _=function(t,e){var i,r=-1,n=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:while(++r<n)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<n)(i=t[r]).callback.call(i.ctx,s);return;case 2:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a);return;case 3:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a,o);return;default:while(++r<n)(i=t[r]).callback.apply(i.ctx,e);return}};l.bind=l.on;l.unbind=l.off;i.extend(e,l);var y=e.Model=function(t,e){var r=t||{};e||(e={});this.cid=i.uniqueId(this.cidPrefix);this.attributes={};if(e.collection)this.collection=e.collection;if(e.parse)r=this.parse(r,e)||{};r=i.defaults({},r,i.result(this,"defaults"));this.set(r,e);this.changed={};this.initialize.apply(this,arguments)};i.extend(y.prototype,l,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return this.get(t)!=null},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,r){if(t==null)return this;var n;if(typeof t==="object"){n=t;r=e}else{(n={})[t]=e}r||(r={});if(!this._validate(n,r))return false;var s=r.unset;var a=r.silent;var o=[];var h=this._changing;this._changing=true;if(!h){this._previousAttributes=i.clone(this.attributes);this.changed={}}var u=this.attributes;var l=this.changed;var c=this._previousAttributes;for(var f in n){e=n[f];if(!i.isEqual(u[f],e))o.push(f);if(!i.isEqual(c[f],e)){l[f]=e}else{delete l[f]}s?delete u[f]:u[f]=e}this.id=this.get(this.idAttribute);if(!a){if(o.length)this._pending=r;for(var d=0;d<o.length;d++){this.trigger("change:"+o[d],this,u[o[d]],r)}}if(h)return this;if(!a){while(this._pending){r=this._pending;this._pending=false;this.trigger("change",this,r)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:true}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,i.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!i.isEmpty(this.changed);return i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):false;var e=this._changing?this._previousAttributes:this.attributes;var r={};for(var n in t){var s=t[n];if(i.isEqual(e[n],s))continue;r[n]=s}return i.size(r)?r:false},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:true},t);var e=this;var r=t.success;t.success=function(i){var n=t.parse?e.parse(i,t):i;if(!e.set(n,t))return false;if(r)r.call(t.context,e,i,t);e.trigger("sync",e,i,t)};z(this,t);return this.sync("read",this,t)},save:function(t,e,r){var n;if(t==null||typeof t==="object"){n=t;r=e}else{(n={})[t]=e}r=i.extend({validate:true,parse:true},r);var s=r.wait;if(n&&!s){if(!this.set(n,r))return false}else{if(!this._validate(n,r))return false}var a=this;var o=r.success;var h=this.attributes;r.success=function(t){a.attributes=h;var e=r.parse?a.parse(t,r):t;if(s)e=i.extend({},n,e);if(e&&!a.set(e,r))return false;if(o)o.call(r.context,a,t,r);a.trigger("sync",a,t,r)};z(this,r);if(n&&s)this.attributes=i.extend({},h,n);var u=this.isNew()?"create":r.patch?"patch":"update";if(u==="patch"&&!r.attrs)r.attrs=n;var l=this.sync(u,this,r);this.attributes=h;return l},destroy:function(t){t=t?i.clone(t):{};var e=this;var r=t.success;var n=t.wait;var s=function(){e.stopListening();e.trigger("destroy",e,e.collection,t)};t.success=function(i){if(n)s();if(r)r.call(t.context,e,i,t);if(!e.isNew())e.trigger("sync",e,i,t)};var a=false;if(this.isNew()){i.defer(t.success)}else{z(this,t);a=this.sync("delete",this,t)}if(!n)s();return a},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||F();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.defaults({validate:true},t))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=i.extend({},this.attributes,t);var r=this.validationError=this.validate(t,e)||null;if(!r)return true;this.trigger("invalid",this,r,i.extend(e,{validationError:r}));return false}});var b={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};o(y,b,"attributes");var x=e.Collection=function(t,e){e||(e={});if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,i.extend({silent:true},e))};var w={add:true,remove:true,merge:true};var E={add:true,remove:false};var k=function(t,e,i){var r=Array(t.length-i);var n=e.length;for(var s=0;s<r.length;s++)r[s]=t[s+i];for(s=0;s<n;s++)t[s+i]=e[s];for(s=0;s<r.length;s++)t[s+n+i]=r[s]};i.extend(x.prototype,l,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:false},e,E))},remove:function(t,e){e=i.extend({},e);var r=!i.isArray(t);t=r?[t]:i.clone(t);var n=this._removeModels(t,e);if(!e.silent&&n)this.trigger("update",this,e);return r?n[0]:n},set:function(t,e){if(t==null)return;e=i.defaults({},e,w);if(e.parse&&!this._isModel(t))t=this.parse(t,e);var r=!i.isArray(t);t=r?[t]:t.slice();var n=e.at;if(n!=null)n=+n;if(n<0)n+=this.length+1;var s=[];var a=[];var o=[];var h={};var u=e.add;var l=e.merge;var c=e.remove;var f=false;var d=this.comparator&&n==null&&e.sort!==false;var v=i.isString(this.comparator)?this.comparator:null;var g;for(var p=0;p<t.length;p++){g=t[p];var m=this.get(g);if(m){if(l&&g!==m){var _=this._isModel(g)?g.attributes:g;if(e.parse)_=m.parse(_,e);m.set(_,e);if(d&&!f)f=m.hasChanged(v)}if(!h[m.cid]){h[m.cid]=true;s.push(m)}t[p]=m}else if(u){g=t[p]=this._prepareModel(g,e);if(g){a.push(g);this._addReference(g,e);h[g.cid]=true;s.push(g)}}}if(c){for(p=0;p<this.length;p++){g=this.models[p];if(!h[g.cid])o.push(g)}if(o.length)this._removeModels(o,e)}var y=false;var b=!d&&u&&c;if(s.length&&b){y=this.length!=s.length||i.some(this.models,function(t,e){return t!==s[e]});this.models.length=0;k(this.models,s,0);this.length=this.models.length}else if(a.length){if(d)f=true;k(this.models,a,n==null?this.length:n);this.length=this.models.length}if(f)this.sort({silent:true});if(!e.silent){for(p=0;p<a.length;p++){if(n!=null)e.index=n+p;g=a[p];g.trigger("add",g,this,e)}if(f||y)this.trigger("sort",this,e);if(a.length||o.length)this.trigger("update",this,e)}return r?t[0]:t},reset:function(t,e){e=e?i.clone(e):{};for(var r=0;r<this.models.length;r++){this._removeReference(this.models[r],e)}e.previousModels=this.models;this._reset();t=this.add(t,i.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(t==null)return void 0;var e=this.modelId(this._isModel(t)?t.attributes:t);return this._byId[t]||this._byId[e]||this._byId[t.cid]},at:function(t){if(t<0)t+=this.length;return this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,true)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var r=e.length;if(i.isFunction(e))e=i.bind(e,this);if(r===1||i.isString(e)){this.models=this.sortBy(e)}else{this.models.sort(e)}if(!t.silent)this.trigger("sort",this,t);return this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=i.extend({parse:true},t);var e=t.success;var r=this;t.success=function(i){var n=t.reset?"reset":"set";r[n](i,t);if(e)e.call(t.context,r,i,t);r.trigger("sync",r,i,t)};z(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var r=e.wait;t=this._prepareModel(t,e);if(!t)return false;if(!r)this.add(t,e);var n=this;var s=e.success;e.success=function(t,e,i){if(r)n.add(t,i);if(s)s.call(i.context,t,e,i)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(this._isModel(t)){if(!t.collection)t.collection=this;return t}e=e?i.clone(e):{};e.collection=this;var r=new this.model(t,e);if(!r.validationError)return r;this.trigger("invalid",this,r.validationError,e);return false},_removeModels:function(t,e){var i=[];for(var r=0;r<t.length;r++){var n=this.get(t[r]);if(!n)continue;var s=this.indexOf(n);this.models.splice(s,1);this.length--;if(!e.silent){e.index=s;n.trigger("remove",n,this,e)}i.push(n);this._removeReference(n,e)}return i.length?i:false},_isModel:function(t){return t instanceof y},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);if(i!=null)this._byId[i]=t;t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);if(i!=null)delete this._byId[i];if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(t==="change"){var n=this.modelId(e.previousAttributes());var s=this.modelId(e.attributes);if(n!==s){if(n!=null)delete this._byId[n];if(s!=null)this._byId[s]=e}}this.trigger.apply(this,arguments)}});var S={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};o(x,S,"models");var I=e.View=function(t){this.cid=i.uniqueId("view");i.extend(this,i.pick(t,P));this._ensureElement();this.initialize.apply(this,arguments)};var T=/^(\S+)\s*(.*)$/;var P=["model","collection","el","id","attributes","className","tagName","events"];i.extend(I.prototype,l,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(t){this.undelegateEvents();this._setElement(t);this.delegateEvents();return this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t);this.el=this.$el[0]},delegateEvents:function(t){t||(t=i.result(this,"events"));if(!t)return this;this.undelegateEvents();for(var e in t){var r=t[e];if(!i.isFunction(r))r=this[r];if(!r)continue;var n=e.match(T);this.delegate(n[1],n[2],i.bind(r,this))}return this},delegate:function(t,e,i){this.$el.on(t+".delegateEvents"+this.cid,e,i);return this},undelegateEvents:function(){if(this.$el)this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(t,e,i){this.$el.off(t+".delegateEvents"+this.cid,e,i);return this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(!this.el){var t=i.extend({},i.result(this,"attributes"));if(this.id)t.id=i.result(this,"id");if(this.className)t["class"]=i.result(this,"className");this.setElement(this._createElement(i.result(this,"tagName")));this._setAttributes(t)}else{this.setElement(i.result(this,"el"))}},_setAttributes:function(t){this.$el.attr(t)}});e.sync=function(t,r,n){var s=H[t];i.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:s,dataType:"json"};if(!n.url){a.url=i.result(r,"url")||F()}if(n.data==null&&r&&(t==="create"||t==="update"||t==="patch")){a.contentType="application/json";a.data=JSON.stringify(n.attrs||r.toJSON(n))}if(n.emulateJSON){a.contentType="application/x-www-form-urlencoded";a.data=a.data?{model:a.data}:{}}if(n.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){a.type="POST";if(n.emulateJSON)a.data._method=s;var o=n.beforeSend;n.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",s);if(o)return o.apply(this,arguments)}}if(a.type!=="GET"&&!n.emulateJSON){a.processData=false}var h=n.error;n.error=function(t,e,i){n.textStatus=e;n.errorThrown=i;if(h)h.call(n.context,t,e,i)};var u=n.xhr=e.ajax(i.extend(a,n));r.trigger("request",r,u,n);return u};var H={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var $=e.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var A=/\((.*?)\)/g;var C=/(\(\?)?:\w+/g;var R=/\*\w+/g;var j=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend($.prototype,l,{initialize:function(){},route:function(t,r,n){if(!i.isRegExp(t))t=this._routeToRegExp(t);if(i.isFunction(r)){n=r;r=""}if(!n)n=this[r];var s=this;e.history.route(t,function(i){var a=s._extractParameters(t,i);if(s.execute(n,a,r)!==false){s.trigger.apply(s,["route:"+r].concat(a));s.trigger("route",r,a);e.history.trigger("route",s,r,a)}});return this},execute:function(t,e,i){if(t)t.apply(this,e)},navigate:function(t,i){e.history.navigate(t,i);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=i.result(this,"routes");var t,e=i.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(j,"\\$&").replace(A,"(?:$1)?").replace(C,function(t,e){return e?t:"([^/?]+)"}).replace(R,"([^?]*?)");return new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return i.map(r,function(t,e){if(e===r.length-1)return t||null;return t?decodeURIComponent(t):null})}});var N=e.History=function(){this.handlers=[];this.checkUrl=i.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var M=/^[#\/]|\s+$/g;var O=/^\/+|\/+$/g;var U=/#.*$/;N.started=false;i.extend(N.prototype,l,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname);var e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return t.charAt(0)==="/"?t.slice(1):t},getFragment:function(t){if(t==null){if(this._usePushState||!this._wantsHashChange){t=this.getPath()}else{t=this.getHash()}}return t.replace(M,"")},start:function(t){if(N.started)throw new Error("Backbone.history has already been started");N.started=true;this.options=i.extend({root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(O,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";this.location.replace(e+"#"+this.getPath());return true}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var r=document.body;var n=r.insertBefore(this.iframe,r.firstChild).contentWindow;n.document.open();n.document.close();n.location.hash="#"+this.fragment}var s=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState){s("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){s("hashchange",this.checkUrl,false)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}if(!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};if(this._usePushState){t("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){t("hashchange",this.checkUrl,false)}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);N.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getHash(this.iframe.contentWindow)}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()},loadUrl:function(t){if(!this.matchRoot())return false;t=this.fragment=this.getFragment(t);return i.some(this.handlers,function(e){if(e.route.test(t)){e.callback(t);return true}})},navigate:function(t,e){if(!N.started)return false;if(!e||e===true)e={trigger:!!e};t=this.getFragment(t||"");var i=this.root;if(t===""||t.charAt(0)==="?"){i=i.slice(0,-1)||"/"}var r=i+t;t=this.decodeFragment(t.replace(U,""));if(this.fragment===t)return;this.fragment=t;if(this._usePushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,r)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var n=this.iframe.contentWindow;if(!e.replace){n.document.open();n.document.close()}this._updateHash(n.location,t,e.replace)}}else{return this.location.assign(r)}if(e.trigger)return this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});e.history=new N;var q=function(t,e){var r=this;var n;if(t&&i.has(t,"constructor")){n=t.constructor}else{n=function(){return r.apply(this,arguments)}}i.extend(n,r,e);var s=function(){this.constructor=n};s.prototype=r.prototype;n.prototype=new s;if(t)i.extend(n.prototype,t);n.__super__=r.prototype;return n};y.extend=x.extend=$.extend=I.extend=N.extend=q;var F=function(){throw new Error('A "url" property or function must be specified')};var z=function(t,e){var i=e.error;e.error=function(r){if(i)i.call(e.context,t,r,e);t.trigger("error",t,r,e)}};return e});

(function(a,b){if(typeof define==="function"&&define.amd){define(["exports","backbone","underscore"],b)}else{if(typeof exports!=="undefined"){b(exports,require("backbone"),require("underscore"))}else{b(a,a.Backbone,a._)}}}(this,function(b,h,d){h.Relational={showWarnings:true};h.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable){throw new Error("Max permits acquired")}else{this._permitsUsed++}},release:function(){if(this._permitsUsed===0){throw new Error("All permits released")}else{this._permitsUsed--}},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(i){if(this._permitsUsed>i){throw new Error("Available permits cannot be less than used permits")}this._permitsAvailable=i}};h.BlockingQueue=function(){this._queue=[]};d.extend(h.BlockingQueue.prototype,h.Semaphore,{_queue:null,add:function(i){if(this.isBlocked()){this._queue.push(i)}else{i()}},process:function(){var i=this._queue;this._queue=[];while(i&&i.length){i.shift()()}},block:function(){this.acquire()},unblock:function(){this.release();if(!this.isBlocked()){this.process()}},isBlocked:function(){return this.isLocked()}});h.Relational.eventQueue=new h.BlockingQueue();h.Store=function(){this._collections=[];this._reverseRelations=[];this._orphanRelations=[];this._subModels=[];this._modelScopes=[b]};d.extend(h.Store.prototype,h.Events,{initializeRelation:function(k,m,j){var l=!d.isString(m.type)?m.type:h[m.type]||this.getObjectByName(m.type);if(l&&l.prototype instanceof h.Relation){var i=new l(k,m,j)}else{h.Relational.showWarnings&&typeof console!=="undefined"&&console.warn("Relation=%o; missing or invalid relation type!",m)}},addModelScope:function(i){this._modelScopes.push(i)},removeModelScope:function(i){this._modelScopes=d.without(this._modelScopes,i)},addSubModels:function(i,j){this._subModels.push({superModelType:j,subModels:i})},setupSuperModel:function(i){d.find(this._subModels,function(j){return d.filter(j.subModels||[],function(l,m){var k=this.getObjectByName(l);if(i===k){j.superModelType._subModels[m]=i;i._superModel=j.superModelType;i._subModelTypeValue=m;i._subModelTypeAttribute=j.superModelType.prototype.subModelTypeAttribute;return true}},this).length},this)},addReverseRelation:function(j){var i=d.any(this._reverseRelations,function(k){return d.all(j||[],function(m,l){return m===k[l]})});if(!i&&j.model&&j.type){this._reverseRelations.push(j);this._addRelation(j.model,j);this.retroFitRelation(j)}},addOrphanRelation:function(j){var i=d.any(this._orphanRelations,function(k){return d.all(j||[],function(m,l){return m===k[l]})});if(!i&&j.model&&j.type){this._orphanRelations.push(j)}},processOrphanRelations:function(){d.each(this._orphanRelations.slice(0),function(i){var j=h.Relational.store.getObjectByName(i.relatedModel);if(j){this.initializeRelation(null,i);this._orphanRelations=d.without(this._orphanRelations,i)}},this)},_addRelation:function(i,j){if(!i.prototype.relations){i.prototype.relations=[]}i.prototype.relations.push(j);d.each(i._subModels||[],function(k){this._addRelation(k,j)},this)},retroFitRelation:function(j){var i=this.getCollection(j.model,false);i&&i.each(function(l){if(!(l instanceof j.model)){return}var k=new j.type(l,j)},this)},getCollection:function(l,k){if(l instanceof h.RelationalModel){l=l.constructor}var i=l;while(i._superModel){i=i._superModel}var j=d.find(this._collections,function(m){return m.model===i});if(!j&&k!==false){j=this._createCollection(i)}return j},getObjectByName:function(i){var k=i.split("."),j=null;d.find(this._modelScopes,function(l){j=d.reduce(k||[],function(m,n){return m?m[n]:undefined},l);if(j&&j!==l){return true}},this);return j},_createCollection:function(j){var i;if(j instanceof h.RelationalModel){j=j.constructor}if(j.prototype instanceof h.RelationalModel){i=new h.Collection();i.model=j;this._collections.push(i)}return i},resolveIdForItem:function(i,j){var k=d.isString(j)||d.isNumber(j)?j:null;if(k===null){if(j instanceof h.RelationalModel){k=j.id}else{if(d.isObject(j)){k=j[i.prototype.idAttribute]}}}if(!k&&k!==0){k=null}return k},find:function(j,k){var m=this.resolveIdForItem(j,k),i=this.getCollection(j);if(i){var l=i.get(m);if(l instanceof j){return l}}return null},register:function(j){var k=this.getCollection(j);if(k){var i=j.collection;k.add(j);j.collection=i}},checkId:function(i,l){var j=this.getCollection(i),k=j&&j.get(l);if(k&&i!==k){if(h.Relational.showWarnings&&typeof console!=="undefined"){console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",k,i)}throw new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")}},update:function(i){var j=this.getCollection(i);if(!j.contains(i)){this.register(i)}j._onModelEvent("change:"+i.idAttribute,i,j);i.trigger("relational:change:id",i,j)},unregister:function(j){var i,k;if(j instanceof h.Model){i=this.getCollection(j);k=[j]}else{if(j instanceof h.Collection){i=this.getCollection(j.model);k=d.clone(j.models)}else{i=this.getCollection(j);k=d.clone(i.models)}}d.each(k,function(l){this.stopListening(l);d.invoke(l.getRelations(),"stopListening")},this);if(d.contains(this._collections,j)){i.reset([])}else{d.each(k,function(l){if(i.get(l)){i.remove(l)}else{i.trigger("relational:remove",l,i)}},this)}},reset:function(){this.stopListening();d.each(this._collections,function(i){this.unregister(i)},this);this._collections=[];this._subModels=[];this._modelScopes=[b]}});h.Relational.store=new h.Store();h.Relation=function(i,j,k){this.instance=i;j=d.isObject(j)?j:{};this.reverseRelation=d.defaults(j.reverseRelation||{},this.options.reverseRelation);this.options=d.defaults(j,this.options,h.Relation.prototype.options);this.reverseRelation.type=!d.isString(this.reverseRelation.type)?this.reverseRelation.type:h[this.reverseRelation.type]||h.Relational.store.getObjectByName(this.reverseRelation.type);this.key=this.options.key;this.keySource=this.options.keySource||this.key;this.keyDestination=this.options.keyDestination||this.keySource||this.key;this.model=this.options.model||this.instance.constructor;this.relatedModel=this.options.relatedModel;if(d.isUndefined(this.relatedModel)){this.relatedModel=this.model}if(d.isFunction(this.relatedModel)&&!(this.relatedModel.prototype instanceof h.RelationalModel)){this.relatedModel=d.result(this,"relatedModel")}if(d.isString(this.relatedModel)){this.relatedModel=h.Relational.store.getObjectByName(this.relatedModel)}if(!this.checkPreconditions()){return}if(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key){h.Relational.store.addReverseRelation(d.defaults({isAutoRelation:true,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation))}if(i){var l=this.keySource;if(l!==this.key&&d.isObject(this.instance.get(this.key))){l=this.key}this.setKeyContents(this.instance.get(l));this.relatedCollection=h.Relational.store.getCollection(this.relatedModel);if(this.keySource!==this.key){delete this.instance.attributes[this.keySource]}this.instance._relations[this.key]=this;this.initialize(k);if(this.options.autoFetch){this.instance.getAsync(this.key,d.isObject(this.options.autoFetch)?this.options.autoFetch:{})}this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}};h.Relation.extend=h.Model.extend;d.extend(h.Relation.prototype,h.Events,h.Semaphore,{options:{createModels:true,includeInJSON:true,isAutoRelation:false,autoFetch:false,parse:false},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var n=this.instance,l=this.key,j=this.model,p=this.relatedModel,q=h.Relational.showWarnings&&typeof console!=="undefined";if(!j||!l||!p){q&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,j,l,p);return false}if(!(j.prototype instanceof h.RelationalModel)){q&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,n);return false}if(!(p.prototype instanceof h.RelationalModel)){q&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,p);return false}if(this instanceof h.HasMany&&this.reverseRelation.type===h.HasMany){q&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this);return false}if(n&&d.keys(n._relations).length){var o=d.find(n._relations,function(i){return i.key===l},this);if(o){q&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,l,n,o);return false}}return true},setRelated:function(i){this.related=i;this.instance.attributes[this.key]=i},_isReverseRelation:function(i){return i.instance instanceof this.relatedModel&&this.reverseRelation.key===i.key&&this.key===i.reverseRelation.key},getReverseRelations:function(m){var p=[];var q=!d.isUndefined(m)?[m]:this.related&&(this.related.models||[this.related]),k=null,o=null;for(var n=0;n<(q||[]).length;n++){k=q[n].getRelations()||[];for(var l=0;l<k.length;l++){o=k[l];if(this._isReverseRelation(o)){p.push(o)}}}return p},destroy:function(){this.stopListening();if(this instanceof h.HasOne){this.setRelated(null)}else{if(this instanceof h.HasMany){this.setRelated(this._prepareCollection())}}d.each(this.getReverseRelations(),function(i){i.removeRelated(this.instance)},this)}});h.HasOne=h.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(i){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var j=this.findRelated(i);this.setRelated(j);d.each(this.getReverseRelations(),function(k){k.addRelated(this.instance,i)},this)},findRelated:function(i){var k=null;i=d.defaults({parse:this.options.parse},i);if(this.keyContents instanceof this.relatedModel){k=this.keyContents}else{if(this.keyContents||this.keyContents===0){var j=d.defaults({create:this.options.createModels},i);k=this.relatedModel.findOrCreate(this.keyContents,j)}}if(k){this.keyId=null}return k},setKeyContents:function(i){this.keyContents=i;this.keyId=h.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(l,i,k){if(this.isLocked()){return}this.acquire();k=k?d.clone(k):{};var o=d.isUndefined(k.__related),m=o?this.related:k.__related;if(o){this.setKeyContents(i);var n=this.findRelated(k);this.setRelated(n)}if(m&&this.related!==m){d.each(this.getReverseRelations(m),function(p){p.removeRelated(this.instance,null,k)},this)}d.each(this.getReverseRelations(),function(p){p.addRelated(this.instance,k)},this);if(!k.silent&&this.related!==m){var j=this;this.changed=true;h.Relational.eventQueue.add(function(){j.instance.trigger("change:"+j.key,j.instance,j.related,k,true);j.changed=false})}this.release()},tryAddRelated:function(j,k,i){if((this.keyId||this.keyId===0)&&j.id===this.keyId){this.addRelated(j,i);this.keyId=null}},addRelated:function(k,j){var i=this;k.queue(function(){if(k!==i.related){var l=i.related||null;i.setRelated(k);i.onChange(i.instance,k,d.defaults({__related:l},j))}})},removeRelated:function(j,k,i){if(!this.related){return}if(j===this.related){var l=this.related||null;this.setRelated(null);this.onChange(this.instance,j,d.defaults({__related:l},i))}}});h.HasMany=h.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:h.Collection,collectionKey:true,collectionOptions:{}},initialize:function(i){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);this.collectionType=this.options.collectionType;if(d.isFunction(this.collectionType)&&this.collectionType!==h.Collection&&!(this.collectionType.prototype instanceof h.Collection)){this.collectionType=d.result(this,"collectionType")}if(d.isString(this.collectionType)){this.collectionType=h.Relational.store.getObjectByName(this.collectionType)}if(this.collectionType!==h.Collection&&!(this.collectionType.prototype instanceof h.Collection)){throw new Error("`collectionType` must inherit from Backbone.Collection")}var j=this.findRelated(i);this.setRelated(j)},_prepareCollection:function(k){if(this.related){this.stopListening(this.related)}if(!k||!(k instanceof h.Collection)){var i=d.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;k=new this.collectionType(null,i)}k.model=this.relatedModel;if(this.options.collectionKey){var j=this.options.collectionKey===true?this.options.reverseRelation.key:this.options.collectionKey;if(k[j]&&k[j]!==this.instance){if(h.Relational.showWarnings&&typeof console!=="undefined"){console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,j,this.options.collectionKey)}}else{if(j){k[j]=this.instance}}}this.listenTo(k,"relational:add",this.handleAddition).listenTo(k,"relational:remove",this.handleRemoval).listenTo(k,"relational:reset",this.handleReset);return k},findRelated:function(i){var k=null;i=d.defaults({parse:this.options.parse},i);if(this.keyContents instanceof h.Collection){this._prepareCollection(this.keyContents);k=this.keyContents}else{var j=[];d.each(this.keyContents,function(l){var m=null;if(l instanceof this.relatedModel){m=l}else{m=(d.isObject(l)&&i.parse&&this.relatedModel.prototype.parse)?this.relatedModel.prototype.parse(d.clone(l),i):l}m&&j.push(m)},this);if(this.related instanceof h.Collection){k=this.related}else{k=this._prepareCollection()}k.set(j,d.defaults({parse:false},i))}this.keyIds=d.difference(this.keyIds,d.pluck(k.models,"id"));return k},setKeyContents:function(i){this.keyContents=i instanceof h.Collection?i:null;this.keyIds=[];if(!this.keyContents&&(i||i===0)){this.keyContents=d.isArray(i)?i:[i];d.each(this.keyContents,function(j){var k=h.Relational.store.resolveIdForItem(this.relatedModel,j);if(k||k===0){this.keyIds.push(k)}},this)}},onChange:function(l,i,k){k=k?d.clone(k):{};this.setKeyContents(i);this.changed=false;var m=this.findRelated(k);this.setRelated(m);if(!k.silent){var j=this;h.Relational.eventQueue.add(function(){if(j.changed){j.instance.trigger("change:"+j.key,j.instance,j.related,k,true);j.changed=false}})}},handleAddition:function(k,l,j){j=j?d.clone(j):{};this.changed=true;d.each(this.getReverseRelations(k),function(m){m.addRelated(this.instance,j)},this);var i=this;!j.silent&&h.Relational.eventQueue.add(function(){i.instance.trigger("add:"+i.key,k,i.related,j)})},handleRemoval:function(k,l,j){j=j?d.clone(j):{};this.changed=true;d.each(this.getReverseRelations(k),function(m){m.removeRelated(this.instance,null,j)},this);var i=this;!j.silent&&h.Relational.eventQueue.add(function(){i.instance.trigger("remove:"+i.key,k,i.related,j)})},handleReset:function(k,j){var i=this;j=j?d.clone(j):{};!j.silent&&h.Relational.eventQueue.add(function(){i.instance.trigger("reset:"+i.key,i.related,j)})},tryAddRelated:function(j,k,i){var l=d.contains(this.keyIds,j.id);if(l){this.addRelated(j,i);this.keyIds=d.without(this.keyIds,j.id)}},addRelated:function(k,j){var i=this;k.queue(function(){if(i.related&&!i.related.get(k)){i.related.add(k,d.defaults({parse:false},j))}})},removeRelated:function(j,k,i){if(this.related.get(j)){this.related.remove(j,i)}}});h.RelationalModel=h.Model.extend({relations:null,_relations:null,_isInitialized:false,_deferProcessing:false,_queue:null,_attributeChangeFired:false,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(j,k){if(k&&k.collection){var i=this,m=this.collection=k.collection;delete k.collection;this._deferProcessing=true;var l=function(n){if(n===i){i._deferProcessing=false;i.processQueue();m.off("relational:add",l)}};m.on("relational:add",l);d.defer(function(){l(i)})}h.Relational.store.processOrphanRelations();h.Relational.store.listenTo(this,"relational:unregister",h.Relational.store.unregister);this._queue=new h.BlockingQueue();this._queue.block();h.Relational.eventQueue.block();try{h.Model.apply(this,arguments)}finally{h.Relational.eventQueue.unblock()}},trigger:function(j){if(j.length>5&&j.indexOf("change")===0){var i=this,k=arguments;if(!h.Relational.eventQueue.isBlocked()){h.Model.prototype.trigger.apply(i,k)}else{h.Relational.eventQueue.add(function(){var n=true;if(j==="change"){n=i.hasChanged()||i._attributeChangeFired;i._attributeChangeFired=false}else{var m=j.slice(7),l=i.getRelation(m);if(l){n=(k[4]===true);if(n){i.changed[m]=k[2]}else{if(!l.changed){delete i.changed[m]}}}else{if(n){i._attributeChangeFired=true}}}n&&h.Model.prototype.trigger.apply(i,k)})}}else{if(j==="destroy"){h.Model.prototype.trigger.apply(this,arguments);h.Relational.store.unregister(this)}else{h.Model.prototype.trigger.apply(this,arguments)}}return this},initializeRelations:function(i){this.acquire();this._relations={};d.each(this.relations||[],function(j){h.Relational.store.initializeRelation(this,j,i)},this);this._isInitialized=true;this.release();this.processQueue()},updateRelations:function(j,i){if(this._isInitialized&&!this.isLocked()){d.each(this._relations,function(l){if(!j||(l.keySource in j||l.key in j)){var m=this.attributes[l.keySource]||this.attributes[l.key],k=j&&(j[l.keySource]||j[l.key]);if(l.related!==m||(m===null&&k===null)){this.trigger("relational:change:"+l.key,this,m,i||{})}}if(l.keySource!==l.key){delete this.attributes[l.keySource]}},this)}},queue:function(i){this._queue.add(i)},processQueue:function(){if(this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()){this._queue.unblock()}},getRelation:function(i){return this._relations[i]},getRelations:function(){return d.values(this._relations)},getIdsToFetch:function(j,l){var i=j instanceof h.Relation?j:this.getRelation(j),k=i?(i.keyIds&&i.keyIds.slice(0))||((i.keyId||i.keyId===0)?[i.keyId]:[]):[];if(l){var m=i.related&&(i.related.models||[i.related]);d.each(m,function(n){if(n.id||n.id===0){k.push(n.id)}})}return k},getAsync:function(r,u){u=d.extend({add:true,remove:false,refresh:false},u);var n=this,j=[],t=this.getRelation(r),m=t&&this.getIdsToFetch(t,u.refresh),k=t.related instanceof h.Collection?t.related:t.relatedCollection;if(m&&m.length){var l=[],s=[],o,p=function(){l=d.map(m,function(x){var w=t.relatedModel.findModel(x);if(!w){var v={};v[t.relatedModel.prototype.idAttribute]=x;w=t.relatedModel.findOrCreate(v,u);s.push(w)}return w},this)};if(k instanceof h.Collection&&d.isFunction(k.url)){var q=k.url();o=k.url(m);if(o===q){p();o=k.url(l);if(o===q){o=null}}}if(o){var i=d.defaults({error:function(){d.each(s,function(v){v.trigger("destroy",v,v.collection,u)});u.error&&u.error.apply(l,arguments)},url:o},u);j=[k.fetch(i)]}else{if(!l.length){p()}j=d.map(l,function(v){var w=d.defaults({error:function(){if(d.contains(s,v)){v.trigger("destroy",v,v.collection,u)}u.error&&u.error.apply(l,arguments)}},u);return v.fetch(w)},this)}}return this.deferArray(j).then(function(){return h.Model.prototype.get.call(n,r)})},deferArray:function(i){return h.$.when.apply(null,i)},set:function(m,n,l){h.Relational.eventQueue.block();var j,i;if(d.isObject(m)||m==null){j=m;l=n}else{j={};j[m]=n}try{var o=this.id,k=j&&this.idAttribute in j&&j[this.idAttribute];h.Relational.store.checkId(this,k);i=h.Model.prototype.set.apply(this,arguments);if(!this._isInitialized&&!this.isLocked()){this.constructor.initializeModelHierarchy();if(k||k===0){h.Relational.store.register(this)}this.initializeRelations(l)}else{if(k&&k!==o){h.Relational.store.update(this)}}if(j){this.updateRelations(j,l)}}finally{h.Relational.eventQueue.unblock()}return i},clone:function(){var i=d.clone(this.attributes);if(!d.isUndefined(i[this.idAttribute])){i[this.idAttribute]=null}d.each(this.getRelations(),function(j){delete i[j.key]});return new this.constructor(i)},toJSON:function(i){if(this.isLocked()){return this.id}this.acquire();var j=h.Model.prototype.toJSON.call(this,i);if(this.constructor._superModel&&!(this.constructor._subModelTypeAttribute in j)){j[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue}d.each(this._relations,function(k){var m=j[k.key],n=k.options.includeInJSON,l=null;if(n===true){if(m&&d.isFunction(m.toJSON)){l=m.toJSON(i)}}else{if(d.isString(n)){if(m instanceof h.Collection){l=m.pluck(n)}else{if(m instanceof h.Model){l=m.get(n)}}if(n===k.relatedModel.prototype.idAttribute){if(k instanceof h.HasMany){l=l.concat(k.keyIds)}else{if(k instanceof h.HasOne){l=l||k.keyId;if(!l&&!d.isObject(k.keyContents)){l=k.keyContents||null}}}}}else{if(d.isArray(n)){if(m instanceof h.Collection){l=[];m.each(function(p){var o={};d.each(n,function(q){o[q]=p.get(q)});l.push(o)})}else{if(m instanceof h.Model){l={};d.each(n,function(o){l[o]=m.get(o)})}}}else{delete j[k.key]}}}if(l===null&&i&&i.wait){l=m}if(n){j[k.keyDestination]=l}if(k.keyDestination!==k.key){delete j[k.key]}});this.release();return j}},{setup:function(i){this.prototype.relations=(this.prototype.relations||[]).slice(0);this._subModels={};this._superModel=null;if(this.prototype.hasOwnProperty("subModelTypes")){h.Relational.store.addSubModels(this.prototype.subModelTypes,this)}else{this.prototype.subModelTypes=null}d.each(this.prototype.relations||[],function(j){if(!j.model){j.model=this}if(j.reverseRelation&&j.model===this){var l=true;if(d.isString(j.relatedModel)){var k=h.Relational.store.getObjectByName(j.relatedModel);l=k&&(k.prototype instanceof h.RelationalModel)}if(l){h.Relational.store.initializeRelation(null,j)}else{if(d.isString(j.relatedModel)){h.Relational.store.addOrphanRelation(j)}}}},this);return this},build:function(i,k){this.initializeModelHierarchy();var j=this._findSubModelType(this,i)||this;return new j(i,k)},_findSubModelType:function(l,k){if(l._subModels&&l.prototype.subModelTypeAttribute in k){var j=k[l.prototype.subModelTypeAttribute];var i=l._subModels[j];if(i){return i}else{for(j in l._subModels){i=this._findSubModelType(l._subModels[j],k);if(i){return i}}}}return null},initializeModelHierarchy:function(){this.inheritRelations();if(this.prototype.subModelTypes){var j=d.keys(this._subModels);var i=d.omit(this.prototype.subModelTypes,j);d.each(i,function(l){var k=h.Relational.store.getObjectByName(l);k&&k.initializeModelHierarchy()})}},inheritRelations:function(){if(!d.isUndefined(this._superModel)&&!d.isNull(this._superModel)){return}h.Relational.store.setupSuperModel(this);if(this._superModel){this._superModel.inheritRelations();if(this._superModel.prototype.relations){var i=d.filter(this._superModel.prototype.relations||[],function(j){return !d.any(this.prototype.relations||[],function(k){return j.relatedModel===k.relatedModel&&j.key===k.key},this)},this);this.prototype.relations=i.concat(this.prototype.relations)}}else{this._superModel=false}},findOrCreate:function(i,k){k||(k={});var l=(d.isObject(i)&&k.parse&&this.prototype.parse)?this.prototype.parse(d.clone(i),k):i;var j=this.findModel(l);if(d.isObject(i)){if(j&&k.merge!==false){delete k.collection;delete k.url;j.set(l,k)}else{if(!j&&k.create!==false){j=this.build(l,d.defaults({parse:false},k))}}}return j},find:function(i,j){j||(j={});j.create=false;return this.findOrCreate(i,j)},findModel:function(i){return h.Relational.store.find(this,i)}});d.extend(h.RelationalModel.prototype,h.Semaphore);h.Collection.prototype.__prepareModel=h.Collection.prototype._prepareModel;h.Collection.prototype._prepareModel=function(k,j){var i;if(k instanceof h.Model){if(!k.collection){k.collection=this}i=k}else{j=j?d.clone(j):{};j.collection=this;if(typeof this.model.findOrCreate!=="undefined"){i=this.model.findOrCreate(k,j)}else{i=new this.model(k,j)}if(i&&i.validationError){this.trigger("invalid",this,k,j);i=false}}return i};var g=h.Collection.prototype.__set=h.Collection.prototype.set;h.Collection.prototype.set=function(q,m){if(!(this.model.prototype instanceof h.RelationalModel)){return g.call(this,q,m)}if(m&&m.parse){q=this.parse(q,m)}var p=!d.isArray(q),k=[],o=[],l=null;q=p?(q?[q]:[]):d.clone(q);for(var n=0;n<q.length;n++){l=q[n];if(!(l instanceof h.Model)){l=h.Collection.prototype._prepareModel.call(this,l,m)}if(l){o.push(l);if(!(this.get(l)||this.get(l.cid))){k.push(l)}else{if(l.id!==null&&l.id!==undefined){this._byId[l.id]=l}}}}o=p?(o.length?o[0]:null):o;var j=g.call(this,o,d.defaults({merge:false,parse:false},m));for(n=0;n<k.length;n++){l=k[n];if(this.get(l)||this.get(l.cid)){this.trigger("relational:add",l,this,m)}}return j};var a=h.Collection.prototype.___removeModels=h.Collection.prototype._removeModels;h.Collection.prototype._removeModels=function(l,j){if(!(this.model.prototype instanceof h.RelationalModel)){return a.call(this,l,j)}var k=[];d.each(l,function(m){m=this.get(m)||(m&&this.get(m.cid));m&&k.push(m)},this);var i=a.call(this,k,j);d.each(k,function(m){this.trigger("relational:remove",m,this,j)},this);return i};var f=h.Collection.prototype.__reset=h.Collection.prototype.reset;h.Collection.prototype.reset=function(k,j){j=d.extend({merge:true},j);var i=f.call(this,k,j);if(this.model.prototype instanceof h.RelationalModel){this.trigger("relational:reset",this,j)}return i};var e=h.Collection.prototype.__sort=h.Collection.prototype.sort;h.Collection.prototype.sort=function(j){var i=e.call(this,j);if(this.model.prototype instanceof h.RelationalModel){this.trigger("relational:reset",this,j)}return i};var c=h.Collection.prototype.__trigger=h.Collection.prototype.trigger;h.Collection.prototype.trigger=function(j){if(!(this.model.prototype instanceof h.RelationalModel)){return c.apply(this,arguments)}if(j==="add"||j==="remove"||j==="reset"||j==="sort"){var i=this,k=arguments;if(d.isObject(k[3])){k=d.toArray(k);k[3]=d.clone(k[3])}h.Relational.eventQueue.add(function(){c.apply(i,k)})}else{c.apply(this,arguments)}return this};h.RelationalModel.extend=function(i,j){var k=h.Model.extend.call(this,i,j);k.setup(this);return k}}));
